{% extends "base.html" %}

{% block title %}Capitalizaci√≥n{% endblock %}

{% block content %}
<div class="container">
    <div class="header-small">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="FINLY Logo" class="logo-small">
        <h1>üí∞ Capitalizaci√≥n</h1>
        <span class="user-info">{{ username }}</span>
    </div>

    <!-- Secci√≥n de Teor√≠a Colapsable -->
    <div class="teoria-section">
        <button class="teoria-toggle" type="button" id="teoriaBtn">
            <span id="teoriaIcon">‚ñ∂</span> Teor√≠a: ¬øQu√© es la Capitalizaci√≥n?
        </button>
        <div class="teoria-content" id="teoriaContent">
            <h3>üí° Conceptos B√°sicos</h3>
            <p>La <strong>capitalizaci√≥n</strong> es el proceso mediante el cual los intereses generados por un capital se van sumando al mismo para generar nuevos intereses.  
               Es el concepto fundamental del inter√©s compuesto y el crecimiento exponencial del dinero en el tiempo.</p>

            <h4>Tipos de Capitalizaci√≥n:</h4>
            <div class="tipo-box">
                <strong>üîπ Capitalizaci√≥n Simple:</strong> Los intereses no se reinvierten, solo se calculan sobre el capital inicial.<br>
                <strong>üîπ Capitalizaci√≥n Compuesta:</strong> Los intereses se suman al capital y generan nuevos intereses.<br>
                
            </div>

            <h4>F√≥rmulas Principales:</h4>
            <div class="formula-box">
                <strong>Inter√©s Simple:</strong><br>
                VF = P √ó (1 + i √ó n)<br><br>

                <strong>Inter√©s Compuesto:</strong><br>
                VF = P √ó (1 + i)‚Åø<br><br>
            </div>

            <h4>Variables:</h4>
            <ul>
                <li><strong>P (Capital Inicial):</strong> Monto inicial invertido o prestado</li>
                <li><strong>VF (Valor Futuro):</strong> Capital acumulado al final del per√≠odo</li>
                <li><strong>i (Tasa de inter√©s):</strong> Tasa por per√≠odo</li>
                <li><strong>n (Tiempo):</strong> N√∫mero de per√≠odos</li>
                <li><strong>m (Frecuencia):</strong> Veces que se capitaliza por per√≠odo</li>
            </ul>

            <h4>Frecuencias de Capitalizaci√≥n Comunes:</h4>
            <ul>
                <li><strong>Anual:</strong> m = 1</li>
                <li><strong>Semestral:</strong> m = 2</li>
                <li><strong>Trimestral:</strong> m = 4</li>
                <li><strong>Mensual:</strong> m = 12</li>
                <li><strong>Diaria:</strong> m = 365</li>
            </ul>
        </div>
    </div>

    <p>Ingresa los datos para calcular el valor futuro seg√∫n diferentes m√©todos de capitalizaci√≥n. El c√°lculo se realizar√° cuando est√© disponible la conexi√≥n.</p>

    <form id="capitalizacionForm">
        <div class="input-row">
            <div class="input-group">
                <label for="capitalInicial">Capital Inicial (P):</label>
                <input type="number" id="capitalInicial" name="capitalInicial" step="0.01">
                <small>Monto inicial</small>
            </div>

            <div class="input-group">
                <label for="tasa">Tasa de Inter√©s (i):</label>
                <input type="number" id="tasa" name="tasa" step="0.01">
                <small>Tasa anual (%)</small>
            </div>
        </div>

        <div class="input-row">
            <div class="input-group">
                <label for="tiempo">Tiempo (n):</label>
                <input type="number" id="tiempo" name="tiempo" step="0.01">
                <small>A√±os</small>
            </div>

            <div class="input-group full-width">
                <label for="tipoCapitalizacion">Tipo de Capitalizaci√≥n:</label>
                <select id="tipoCapitalizacion" name="tipoCapitalizacion">
                    <option value="simple">Inter√©s Simple</option>
                    <option value="compuesto">Inter√©s Compuesto</option>
                </select>
            </div>
        </div>

        <!-- Campo de frecuencia (oculto por defecto) -->
        <div class="input-row hidden" id="frecuenciaRow">
            <div class="input-group full-width">
                <label for="frecuencia">Frecuencia de Capitalizaci√≥n:</label>
                <select id="frecuencia" name="frecuencia">
                    <option value="1">Anual (1 vez/a√±o)</option>
                    <option value="2">Semestral (2 veces/a√±o)</option>
                    <option value="4">Trimestral (4 veces/a√±o)</option>
                    <option value="12">Mensual (12 veces/a√±o)</option>
                    <option value="52">Semanal (52 veces/a√±o)</option>
                    <option value="365">Diaria (365 veces/a√±o)</option>
                </select>
            </div>
        </div>

        <button type="button" class="btn" id="calcularBtn">üìä Calcular Capitalizaci√≥n</button>
    </form>

    <div class="result-box hidden" id="resultBox">
        <div class="result-content">
            <h3>üí∞ Resultado:</h3>
            <div class="result-value" id="resultValue">‚Äî</div>
            <div class="result-detail" id="resultDetail">El resultado aparecer√° aqu√≠.</div>
            <div class="result-breakdown hidden" id="resultBreakdown">
                <div class="breakdown-item">
                    <span>Capital Inicial:</span>
                    <span id="capitalInicialDisplay">‚Äî</span>
                </div>
                <div class="breakdown-item">
                    <span>Intereses Ganados:</span>
                    <span id="interesesDisplay">‚Äî</span>
                </div>
                <div class="breakdown-item total">
                    <span>Valor Final:</span>
                    <span id="valorFinalDisplay">‚Äî</span>
                </div>
            </div>
        </div>
    </div>

   
</div>


<script>
// Toggle de la secci√≥n de teor√≠a
// Mostrar/ocultar teor√≠a
    document.getElementById('teoriaBtn').addEventListener('click', function() {
        const content = document.getElementById('teoriaContent');
        const icon = document.getElementById('teoriaIcon');
        content.classList.toggle('show');
        icon.classList.toggle('rotated');
    });

// Mostrar/ocultar frecuencia seg√∫n tipo de capitalizaci√≥n
document.getElementById('tipoCapitalizacion').addEventListener('change', function() {
    const frecuenciaRow = document.getElementById('frecuenciaRow');
    if (this.value === 'compuesto') {
        frecuenciaRow.classList.remove('hidden');
    } else {
        frecuenciaRow.classList.add('hidden');
    }
});

// Funci√≥n para calcular capitalizaci√≥n
document.getElementById('calcularBtn').addEventListener('click', async function() {
    const capitalInicial = parseFloat(document.getElementById('capitalInicial').value);
    const tasa = parseFloat(document.getElementById('tasa').value);
    const tiempo = parseFloat(document.getElementById('tiempo').value);
    const tipoCapitalizacion = document.getElementById('tipoCapitalizacion').value;

    // Validar campos
    if (isNaN(capitalInicial) || isNaN(tasa) || isNaN(tiempo)) {
        alert('Por favor, completa todos los campos correctamente.');
        return;
    }

    if (capitalInicial <= 0 || tasa <= 0 || tiempo <= 0) {
        alert('Todos los valores deben ser mayores a cero.');
        return;
    }

    // Preparar datos para el endpoint
    const data = {
        c: capitalInicial,
        i: tasa,
        n: tiempo
    };

    try {
        // Seleccionar endpoint seg√∫n tipo
        const endpoint = tipoCapitalizacion === 'simple' 
            ? 'http://127.0.0.1:5000/calcular_Capitalizacion_simple' 
            : 'http://127.0.0.1:5000/calcular_Capitalizacion_compuesta';

        // Realizar petici√≥n
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });

        if (!response.ok) {
            throw new Error('Error en el c√°lculo');
        }

        const result = await response.json();
        const valorFuturo = result.Vf;
        const intereses = valorFuturo - capitalInicial;

        // Mostrar resultados
        document.getElementById('resultBox').classList.remove('hidden');
        document.getElementById('resultValue').textContent = `$${valorFuturo.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        
        const tipoTexto = tipoCapitalizacion === 'simple' ? 'Simple' : 'Compuesta';
        document.getElementById('resultDetail').textContent = 
            `Capitalizaci√≥n ${tipoTexto} - ${tiempo} a√±o(s) al ${tasa}% anual`;

        // Mostrar desglose
        document.getElementById('resultBreakdown').classList.remove('hidden');
        document.getElementById('capitalInicialDisplay').textContent = 
            `$${capitalInicial.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        document.getElementById('interesesDisplay').textContent = 
            `$${intereses.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
        document.getElementById('valorFinalDisplay').textContent = 
            `$${valorFuturo.toLocaleString('es-CO', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;

    } catch (error) {
        alert('Error al calcular: ' + error.message);
        console.error('Error:', error);
    }
});
</script>


{% endblock %}