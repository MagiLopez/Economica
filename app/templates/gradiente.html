{% extends "base.html" %}

{% block title %}Gradientes{% endblock %}

{% block content %}
<div class="container">
    <div class="header-small">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="FINLY Logo" class="logo-small">
        <h1>üìà Gradientes</h1>
        <span class="user-info">{{ username }}</span>
    </div>

    <!-- Secci√≥n de Teor√≠a Colapsable -->
    <div class="teoria-section">
        <button class="teoria-toggle" type="button" id="teoriaBtn">
            <span id="teoriaIcon">‚ñ∂</span> Teor√≠a: ¬øQu√© son los Gradientes?
        </button>
        <div class="teoria-content" id="teoriaContent">
            <h3>üí° Conceptos B√°sicos</h3>
            <p>Un <strong>gradiente aritm√©tico</strong> es una serie de pagos o ingresos que cambian en una cantidad constante cada per√≠odo.  
               Es √∫til para analizar situaciones donde los flujos de efectivo crecen o disminuyen regularmente.</p>

            <h4>Tipos de Gradientes:</h4>
            <div class="tipo-box">
                <strong>üîπ Gradiente Aritm√©tico:</strong> Los pagos aumentan o disminuyen en una cantidad constante (G).<br>
                <strong>üîπ Gradiente Geom√©trico:</strong> Los pagos cambian en un porcentaje constante por per√≠odo.
            </div>

            <h4>F√≥rmulas Principales:</h4>
            <div class="formula-box">
                <strong>Valor Presente (VP) ‚Äî Gradiente Aritm√©tico:</strong><br>
                VP = A √ó [(1 + i)‚Åø - 1] / (i(1 + i)‚Åø) + G √ó [((1 + i)‚Åø - i√ón - 1) / (i¬≤(1 + i)‚Åø)]
                <br><br>

                <strong>Valor Futuro (VF) ‚Äî Gradiente Aritm√©tico:</strong><br>
                VF = A √ó [(1 + i)‚Åø - 1] / i + G √ó [((1 + i)‚Åø - i√ón - 1) / i¬≤]
            </div>

            <h4>Variables:</h4>
            <ul>
                <li><strong>A:</strong> Primer pago o flujo base</li>
                <li><strong>G:</strong> Incremento o decremento constante</li>
                <li><strong>n:</strong> N√∫mero de per√≠odos</li>
                <li><strong>i:</strong> Tasa de inter√©s por per√≠odo</li>
                <li><strong>VP / VF:</strong> Valor Presente o Futuro del gradiente</li>
            </ul>
        </div>
    </div>

    <p>Completa exactamente <strong>4 campos</strong> y deja <strong>1 vac√≠o</strong>. El c√°lculo se realizar√° cuando est√© disponible la conexi√≥n.</p>

    <form id="gradientesForm">
        <div class="input-row">
            <div class="input-group">
                <label for="A">Primer pago (A):</label>
                <input type="number" id="A" name="A">
            </div>

            <div class="input-group">
                <label for="G">Gradiente (G):</label>
                <input type="number" id="G" name="G">
            </div>
        </div>

        <div class="input-row">
            <div class="input-group">
                <label for="n">N√∫mero de per√≠odos (n):</label>
                <input type="number" id="n" name="n">
            </div>

            <div class="input-group">
                <label for="tasa">Tasa de inter√©s (i):</label>
                <input type="number" id="tasa" name="tasa" step="0.01">
            </div>
        </div>

        <div class="input-group full-width">
            <label for="calcular">¬øQu√© deseas calcular?</label>
            <select id="calcular" name="calcular">
                <option value="vf">Gradiente Aritm√©tico </option>
                <option value="vp">Gradiente Geom√©trico </option>
            </select>
        </div>

        <button type="button" class="btn" id="calcularBtn">Calcular</button>
    </form>

    <div class="result-box hidden" id="resultBox">
        <div class="result-content">
            <h3>üí∞ Resultado:</h3>
            <div class="result-value" id="resultValue">‚Äî</div>
            <div class="result-detail" id="resultDetail">El resultado aparecer√° aqu√≠.</div>
        </div>
    </div>
</div>

<script>
document.getElementById('calcularBtn').addEventListener('click', async function() {
    const A = parseFloat(document.getElementById('A').value) || 0;
    const G = parseFloat(document.getElementById('G').value) || 0;
    const n = parseFloat(document.getElementById('n').value) || 0;
    const i = parseFloat(document.getElementById('tasa').value) || 0;
    const tipo = document.getElementById('calcular').value;

    const resultBox = document.getElementById('resultBox');
    const resultValue = document.getElementById('resultValue');
    const resultDetail = document.getElementById('resultDetail');

    // Determinar endpoint y payload seg√∫n el tipo
    let endpoint = "";
    let payload = {
        A: A,
        i: i,
        n: n,
        g: 0,
        G: 0
    };

    if (tipo === 'vf') {
        // Gradiente Aritm√©tico
        endpoint = "http://127.0.0.1:5000/calcular_Gradiente_aritmetico";
        payload.g = G;
    } else {
        // Gradiente Geom√©trico
        endpoint = "http://127.0.0.1:5000/calcular_Gradiente_geometrico";
        payload.G = G;
    }

    try {
        const response = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || "Error en el c√°lculo");
        }

        const data = await response.json();

        // Mostrar resultados
        resultBox.classList.remove('hidden');
        
        if (tipo === 'vf') {
            resultValue.textContent = `Valor Futuro: ${data["Valor Futuro Gradiente Aritmetico"]}`;
            resultDetail.textContent = `Valor Actual: ${data["Valor Actual Gradiente Aritmetico"]}`;
        } else {
            resultValue.textContent = `Valor Futuro: ${data["Valor Futuro Gradiente Geometrico"]}`;
            resultDetail.textContent = `Valor Actual: ${data["Valor Actual Gradiente Geometrico"]}`;
        }
        
    } catch (error) {
        resultBox.classList.remove('hidden');
        resultValue.textContent = "‚ö†Ô∏è Error";
        resultDetail.textContent = error.message;
    }
});
</script>

{% endblock %}
