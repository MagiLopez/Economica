{% extends "base.html" %}

{% block title %}Tasa de Inter√©s{% endblock %}

{% block content %}
<div class="container">
    <div class="header-small">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="FINLY Logo" class="logo-small">
        <h1>üí≤ Tasa de Inter√©s</h1>
        <span class="user-info">{{ username }}</span>
    </div>
    
    <p>Completa exactamente <strong>los 3 campos</strong>  El c√°lculo se realizar√° en el servidor.</p>

    <form id="interesForm" method="post">
        <div class="input-row">
            <div class="input-group">
                <label for="capital">Capital (C):</label>
                <input type="number" id="capital" name="capital">
            </div>

        

        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="tiempo">Tiempo (meses):</label>
                <input type="number" id="tiempo" name="tiempo">
            </div>

            <div class="input-group">
                <label for="tasa">Tasa de Inter√©s (i):</label>
                <input type="number" id="tasa" step="0.01">
                <small> </small>
            </div>
        </div>
        

        <button type="submit" class="btn" id="calcularBtn"> Calcular</button>
    </form>

   <div class="result-box hidden" id="resultBox">
        <div class="result-content">
            <h3>üí∞ Resultado:</h3>
            <div class="result-value" id="resultValue">0</div>
            <div class="result-detail" id="resultDetail"></div>
            <div class="result-detail" id="interestDetail"></div>
        </div>
    </div>
</div>

<script>
const form = document.getElementById('interesForm');
const capitalInput = document.getElementById('capital');
const tiempoInput = document.getElementById('tiempo');
const tasaInput = document.getElementById('tasa');
const resultBox = document.getElementById('resultBox');
const resultValue = document.getElementById('resultValue');
const resultDetail = document.getElementById('resultDetail');
const interestDetail = document.getElementById('interestDetail');

form.addEventListener('submit', async function (e) {
    e.preventDefault();
    console.log("Interceptado, no se hace GET");

    // Validar que se ingresen las 3 variables
    if (!capitalInput.value || !tiempoInput.value || !tasaInput.value) {
        resultBox.classList.remove('hidden');
        resultValue.innerText = "‚ö† Campos requeridos";
        resultDetail.innerText = "Debes completar los 3 campos: Capital, Tiempo y Tasa de Inter√©s.";
        interestDetail.innerText = "";
        return;
    }

    // Mostrar loading
    resultBox.classList.remove('hidden');
    resultValue.innerText = "‚è≥ Calculando...";
    resultDetail.innerText = "Enviando datos al servidor...";
    interestDetail.innerText = "";

    try {
        // Preparar datos - ahora con los nombres correctos del modelo backend
        const requestData = {
            Vp: parseFloat(capitalInput.value),           // Capital -> Vp
            n: parseFloat(tiempoInput.value),             // Tiempo -> n  
            i: parseFloat(tasaInput.value) / 100          // Tasa % -> decimal
        };

        console.log('Enviando datos:', requestData);

        // Cambiar la URL al puerto correcto (8000 para FastAPI)
        const response = await fetch('http://127.0.0.1:5000/calcular_Tasa_de_Interes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(requestData)
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || `Error del servidor: ${response.status}`);
        }

        const data = await response.json();
        console.log('Respuesta del servidor:', data);

        // Mostrar resultados usando solo los elementos que existen en tu HTML
        resultValue.innerText = "‚úÖ C√°lculo completado";
        resultDetail.innerText = `üìä Tasa de inter√©s mensual: ${data.i_mensual.toFixed(4)}%`;
        interestDetail.innerText = `üí∞ Valor futuro mensual: $${data.Vf_mensual.toFixed(2)} | Valor futuro total: $${data.Vf.toFixed(2)}`;

    } catch (error) {
        console.error('Error completo:', error);
        resultValue.innerText = "‚ùå Error en el c√°lculo";
        resultDetail.innerText = `Error: ${error.message}`;
        interestDetail.innerText = "Verifica que el servidor est√© ejecut√°ndose y los datos sean v√°lidos.";
    }
});

// Funci√≥n para limpiar el formulario
function limpiarFormulario() {
    capitalInput.value = '';
    tiempoInput.value = '';
    tasaInput.value = '';
    resultBox.classList.add('hidden');
}

// Agregar bot√≥n de limpiar si existe
const limpiarBtn = document.getElementById('limpiarBtn');
if (limpiarBtn) {
    limpiarBtn.addEventListener('click', limpiarFormulario);
}
</script>


{% endblock %}
