{% extends "base.html" %}

{% block title %}Tasa de Inter√©s{% endblock %}

{% block content %}
<div class="container">
    <div class="header-small">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="FINLY Logo" class="logo-small">
        <h1>üí≤ Tasa de Inter√©s</h1>
        <span class="user-info">{{ username }}</span>
    </div>
    
    <p>Completa exactamente <strong>2 campos</strong> y deja <strong>1 vac√≠o</strong>. El c√°lculo se realizar√° en el servidor.</p>

    <form id="interesForm">
        <div class="input-row">
            <div class="input-group">
                <label for="capital">Capital (C):</label>
                <input type="number" id="capital" name="capital">
            </div>

        

        </div>
        <div class="input-row">
            <div class="input-group">
                <label for="tiempo">Tiempo (a√±os):</label>
                <input type="number" id="tiempo" name="tiempo">
            </div>

            <div class="input-group">
                <label for="tasa">Tasa de Inter√©s (i):</label>
                <input type="number" id="tasa" step="0.01">
                <small> </small>
            </div>
        </div>
        

        <button type="submit" class="btn" id="calcularBtn"> Calcular</button>
    </form>

   <div class="result-box hidden" id="resultBox">
        <div class="result-content">
            <h3>üí∞ Resultado:</h3>
            <div class="result-value" id="resultValue">0</div>
            <div class="result-detail" id="resultDetail"></div>
            <div class="result-detail" id="interestDetail"></div>
        </div>
    </div>
</div>

<script>
   const form = document.getElementById('interesForm');
    const capitalInput = document.getElementById('capital');
    const tiempoInput = document.getElementById('tiempo');
    const tasaInput = document.getElementById('tasa');
    const resultBox = document.getElementById('resultBox');
    const resultValue = document.getElementById('resultValue');
    const resultDetail = document.getElementById('resultDetail');
    const interestDetail = document.getElementById('interestDetail');
    const vfMensualDetail = document.getElementById('vfMensualDetail');
    const vfDetail = document.getElementById('vfDetail');

    form.addEventListener('submit', async function (e) {
        e.preventDefault();

        let filled = 0;
        if (capitalInput.value) filled++;
        if (tiempoInput.value) filled++;
        if (tasaInput.value) filled++;

        if (filled !== 2) {
            resultBox.classList.remove('hidden');
            resultValue.innerText = "‚ö† Error de validaci√≥n";
            resultDetail.innerText = "Debes completar exactamente 2 campos y dejar 1 vac√≠o.";
            interestDetail.innerText = "";
            vfMensualDetail.innerText = "";
            vfDetail.innerText = "";
            return;
        }

        // Mostrar loading
        resultBox.classList.remove('hidden');
        resultValue.innerText = "‚è≥ Calculando...";
        resultDetail.innerText = "";
        interestDetail.innerText = "";
        vfMensualDetail.innerText = "";
        vfDetail.innerText = "";

        try {
            // Preparar datos para enviar
            const requestData = {
                capital: capitalInput.value ? parseFloat(capitalInput.value) : null,
                tiempo: tiempoInput.value ? parseFloat(tiempoInput.value) : null,
                tasa: tasaInput.value ? parseFloat(tasaInput.value) : null
            };

            // Enviar solicitud al backend
            const response = await fetch('http://127.0.0.1:5000/calcular_Tasa_de_Interes', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                throw new Error(`Error del servidor: ${response.status}`);
            }

            const data = await response.json();

            // Mostrar resultados
            resultValue.innerText = "‚úÖ C√°lculo completado";
            resultDetail.innerText = `Tasa de inter√©s mensual: ${data.i_mensual.toFixed(4)}%`;
            interestDetail.innerText = `Valor futuro mensual: $${data.Vf_mensual.toFixed(2)}`;
            vfMensualDetail.innerText = `Valor futuro total: $${data.Vf.toFixed(2)}`;
            vfDetail.innerText = "";

        } catch (error) {
            resultValue.innerText = "‚ùå Error";
            resultDetail.innerText = error.message;
            interestDetail.innerText = "";
            vfMensualDetail.innerText = "";
            vfDetail.innerText = "";
        }
    });
</script>
{% endblock %}
